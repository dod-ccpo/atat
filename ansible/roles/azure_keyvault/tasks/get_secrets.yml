
- name: get secrets
  vars:
    url:  "{{ vault_url }}"
    ops_keyvault_client_id: "{{ vault_client_id }}"
    ops_keyvault_secret:    "{{ vault_secret }}"
    ops_keyvault_tenant:  "{{ vault_tenant }}"
    secretname: "tf-{{ deploy_tag | regex_replace('\\.','-') }}"
  set_fact:
    secrets_env: "{{ lookup('azure_keyvault_secret',secretname, vault_url=url, client_id=vault_client_id, secret=vault_secret, tenant_id=vault_tenant) | from_yaml }}"

- name: Include get_secrets
  include_tasks: "{{ role_path }}/tasks/format_secrets.yml"
